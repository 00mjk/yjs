{"version":3,"sources":["Frameworks/XmlFramework.coffee"],"names":[],"mappings":"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","file":"Frameworks/XmlFramework.js","sourceRoot":"/source/","sourcesContent":["\njson_types_uninitialized = require \"../Types/XmlTypes\"\nHistoryBuffer = require \"../HistoryBuffer\"\nEngine = require \"../Engine\"\n\n#\n# Framework for Xml-like data-structures.\n# Known values that are supported:\n#\nclass XmlFramework\n\n  #\n  # @param {String} user_id Unique id of the peer.\n  # @param {Connector} Connector the connector class.\n  #\n  constructor: (user_id, Connector)->\n    @HB = new HistoryBuffer user_id\n    type_manager = json_types_uninitialized @HB\n    @types = type_manager.types\n    @engine = new Engine @HB, type_manager.parser\n    @HB.engine = @engine # TODO: !! only for debugging\n    @connector = new Connector @engine, @HB, type_manager.execution_listener, @\n    #first_word = new @types.XmlType(undefined, undefined, undefined, undefined, document.createElement(\"shared\"))\n    #@HB.addOperation(first_word).execute()\n\n    uid_beg = @HB.getReservedUniqueIdentifier()\n    uid_end = @HB.getReservedUniqueIdentifier()\n    beg = @HB.addOperation(new @types.Delimiter uid_beg, undefined, uid_end).execute()\n    end = @HB.addOperation(new @types.Delimiter uid_end, beg, undefined).execute()\n\n    @root_element = new @types.ReplaceManager undefined, @HB.getReservedUniqueIdentifier(), beg, end\n    @HB.addOperation(@root_element).execute()\n    #@root_element.replace first_word\n\n  #\n  # @return JsonType\n  #\n  getSharedObject: ()->\n    @root_element.val()\n\n  #\n  # Get the initialized connector.\n  #\n  getConnector: ()->\n    @connector\n\n  #\n  # @see HistoryBuffer\n  #\n  getHistoryBuffer: ()->\n    @HB\n\n  #\n  # @see JsonType.setMutableDefault\n  #\n  setMutableDefault: (mutable)->\n    @getSharedObject().setMutableDefault(mutable)\n\n  #\n  # Get the UserId from the HistoryBuffer object.\n  # In most cases this will be the same as the user_id value with which\n  # JsonFramework was initialized (Depending on the HistoryBuffer implementation).\n  #\n  getUserId: ()->\n    @HB.getUserId()\n\n  #\n  # @see JsonType.toJson\n  #\n  toJson : ()->\n    @getSharedObject().toJson()\n\n  #\n  # @see JsonType.val\n  #\n  val : ()->\n    if (arguments.length is 0) or (typeof arguments[0] is \"boolean\")\n      @getSharedObject().val(arguments[0])\n    else if arguments.length is 1\n      newXml = new @types.XmlType(undefined, undefined, undefined, undefined, arguments[0])\n      @HB.addOperation(newXml).execute()\n      @root_element.replace newXml\n      newXml\n    else\n      throw new Error \"can only parse 0, or 1 parameter!\"\n\n\n  #\n  # @see Operation.on\n  #\n  on: ()->\n    @getSharedObject().on arguments...\n\n\n\nmodule.exports = XmlFramework\nif window?\n  if not window.Y?\n    window.Y = {}\n  window.Y.XmlFramework = XmlFramework\n"]}