{"version":3,"sources":["Frameworks/TextFramework.coffee"],"names":[],"mappings":"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","file":"Frameworks/TextFramework.js","sourceRoot":"/source/","sourcesContent":["\ntext_types_uninitialized = require \"../Types/TextTypes\"\nHistoryBuffer = require \"../HistoryBuffer\"\nEngine = require \"../Engine\"\nadaptConnector = require \"../ConnectorAdapter\"\n\n#\n# Framework for Text Datastructures.\n#\nclass TextFramework\n\n  #\n  # @param {String} user_id Uniqe user id that defines this peer.\n  # @param {Connector} Connector The connector defines how you connect to the other peers.\n  #\n  constructor: (user_id, @connector)->\n    @HB = new HistoryBuffer user_id\n    text_types = text_types_uninitialized @HB\n    @types = text_types.types\n    @engine = new Engine @HB, text_types.parser\n    adaptConnector @connector, @engine, @HB, text_types.execution_listener\n\n    beginning = @HB.addOperation new @types.Delimiter {creator: '_', op_number: '_beginning'} , undefined, undefined\n    end =       @HB.addOperation new @types.Delimiter {creator: '_', op_number: '_end'}       , beginning, undefined\n    beginning.next_cl = end\n    beginning.execute()\n    end.execute()\n    first_word = new @types.WordType {creator: '_', op_number: '_'}, beginning, end\n    @HB.addOperation(first_word).execute()\n\n    uid_r = { creator: '_', op_number: \"RM\" }\n    uid_beg = { creator: '_', op_number: \"_RM_beginning\" }\n    uid_end = { creator: '_', op_number: \"_RM_end\" }\n    beg = @HB.addOperation(new @types.Delimiter uid_beg, undefined, uid_end).execute()\n    end = @HB.addOperation(new @types.Delimiter uid_end, beg, undefined).execute()\n    @root_element = @HB.addOperation(new @types.ReplaceManager undefined, uid_r, beg, end).execute()\n    @root_element.replace first_word, { creator: '_', op_number: 'Replaceable'}\n\n\n  #\n  # @return WordType\n  #\n  getSharedObject: ()->\n    @root_element.val()\n\n  #\n  # Get the initialized connector.\n  #\n  getConnector: ()->\n    @connector\n\n  #\n  # @see HistoryBuffer\n  #\n  getHistoryBuffer: ()->\n    @HB\n\n  #\n  # Get the UserId from the HistoryBuffer object.\n  # In most cases this will be the same as the user_id value with which\n  # JsonFramework was initialized (Depending on the HistoryBuffer implementation).\n  #\n  getUserId: ()->\n    @HB.getUserId()\n\n  #\n  # @see JsonType.val\n  #\n  val: ()->\n    @getSharedObject().val()\n\n  #\n  # @see WordType.insertText\n  #\n  insertText: (pos, content)->\n    @getSharedObject().insertText pos, content\n\n  #\n  # @see WordType.deleteText\n  #\n  deleteText: (pos, length)->\n    @getSharedObject().deleteText pos, length\n\n  #\n  # @see WordType.bind\n  #\n  bind: (textarea)->\n    @getSharedObject().bind textarea\n\n  #\n  # @see WordType.replaceText\n  #\n  replaceText: (text)->\n    @getSharedObject().replaceText text\n\n  #\n  # @see Operation.on\n  #\n  on: ()->\n    @root_element.on arguments...\n\n\nmodule.exports = TextFramework\nif window?\n  if not window.Y?\n    window.Y = {}\n  window.Y.TextFramework = TextFramework\n"]}