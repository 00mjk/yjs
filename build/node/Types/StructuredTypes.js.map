{"version":3,"sources":["Types/StructuredTypes.coffee"],"names":[],"mappings":"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","file":"Types/StructuredTypes.js","sourceRoot":"/source/","sourcesContent":["basic_types_uninitialized = require \"./BasicTypes\"\n\nmodule.exports = (HB)->\n  basic_types = basic_types_uninitialized HB\n  types = basic_types.types\n  parser = basic_types.parser\n\n  #\n  # @nodoc\n  # Manages map like objects. E.g. Json-Type and XML attributes.\n  #\n  class MapManager extends types.Operation\n\n    #\n    # @param {Object} uid A unique identifier. If uid is undefined, a new uid will be created.\n    #\n    constructor: (uid)->\n      @map = {}\n      super uid\n\n    #\n    # @see JsonTypes.val\n    #\n    val: (name, content)->\n      if content?\n        if not @map[name]?\n          HB.addOperation(new AddName undefined, @, name).execute()\n        @map[name].replace content\n        @\n      else if name?\n        obj = @map[name]?.val()\n        if obj instanceof types.ImmutableObject\n          obj.val()\n        else\n          obj\n      else\n        result = {}\n        for name,o of @map\n          obj = o.val()\n          if obj instanceof types.ImmutableObject or obj instanceof MapManager\n            obj = obj.val()\n          result[name] = obj\n        result\n\n  #\n  # @nodoc\n  # When a new property in a map manager is created, then the uids of the inserted Operations\n  # must be unique (think about concurrent operations). Therefore only an AddName operation is allowed to\n  # add a property in a MapManager. If two AddName operations on the same MapManager name happen concurrently\n  # only one will AddName operation will be executed.\n  #\n  class AddName extends types.Operation\n\n    #\n    # @param {Object} uid A unique identifier. If uid is undefined, a new uid will be created.\n    # @param {Object} map_manager Uid or reference to the MapManager.\n    # @param {String} name Name of the property that will be added.\n    #\n    constructor: (uid, map_manager, @name)->\n      @saveOperation 'map_manager', map_manager\n      super uid\n\n    #\n    # If map_manager doesn't have the property name, then add it.\n    # The ReplaceManager that is being written on the property is unique\n    # in such a way that if AddName is executed (from another peer) it will\n    # always have the same result (ReplaceManager, and its beginning and end are the same)\n    #\n    execute: ()->\n      if not @validateSavedOperations()\n        return false\n      else\n        uid_r = @map_manager.getUid()\n        uid_r.op_number = \"_#{uid_r.op_number}_RM_#{@name}\"\n        if not HB.getOperation(uid_r)?\n          uid_beg = @map_manager.getUid()\n          uid_beg.op_number = \"_#{uid_beg.op_number}_RM_#{@name}_beginning\"\n          uid_end = @map_manager.getUid()\n          uid_end.op_number = \"_#{uid_end.op_number}_RM_#{@name}_end\"\n          beg = HB.addOperation(new types.Delimiter uid_beg, undefined, uid_end).execute()\n          end = HB.addOperation(new types.Delimiter uid_end, beg, undefined).execute()\n          @map_manager.map[@name] = HB.addOperation(new ReplaceManager undefined, uid_r, beg, end)\n          @map_manager.map[@name].setParent @map_manager, @name\n          @map_manager.map[@name].execute()\n        super\n\n    #\n    # Encode this operation in such a way that it can be parsed by remote peers.\n    #\n    _encode: ()->\n      {\n        'type' : \"AddName\"\n        'uid' : @getUid()\n        'map_manager' : @map_manager.getUid()\n        'name' : @name\n      }\n\n  parser['AddName'] = (json)->\n    {\n      'map_manager' : map_manager\n      'uid' : uid\n      'name' : name\n    } = json\n    new AddName uid, map_manager, name\n\n  #\n  # @nodoc\n  # Manages a list of Insert-type operations.\n  #\n  class ListManager extends types.Insert\n\n    #\n    # A ListManager maintains a non-empty list that has a beginning and an end (both Delimiters!)\n    # @param {Object} uid A unique identifier. If uid is undefined, a new uid will be created.\n    # @param {Delimiter} beginning Reference or Object.\n    # @param {Delimiter} end Reference or Object.\n    constructor: (uid, beginning, end, prev, next, origin)->\n      if beginning? and end?\n        @saveOperation 'beginning', beginning\n        @saveOperation 'end', end\n      else\n        @beginning = HB.addOperation new types.Delimiter undefined, undefined, undefined\n        @end =       HB.addOperation new types.Delimiter undefined, @beginning, undefined\n        @beginning.next_cl = @end\n        @beginning.execute()\n        @end.execute()\n      super uid, prev, next, origin\n\n    #\n    # @private\n    # @see Operation.execute\n    #\n    execute: ()->\n      if @validateSavedOperations()\n        @beginning.setParent @\n        @end.setParent @\n        super\n      else\n        false\n\n    # Get the element previous to the delemiter at the end\n    getLastOperation: ()->\n      @end.prev_cl\n\n    # similar to the above\n    getFirstOperation: ()->\n      @beginning.next_cl\n\n    # Transforms the the list to an array\n    # Doesn't return left-right delimiter.\n    toArray: ()->\n      o = @beginning.next_cl\n      result = []\n      while o isnt @end\n        result.push o\n        o = o.next_cl\n      result\n\n    #\n    # Retrieves the x-th not deleted element.\n    #\n    getOperationByPosition: (position)->\n      o = @beginning.next_cl\n      if (position > 0 or o.isDeleted()) and not (o instanceof types.Delimiter)\n        while o.isDeleted() and not (o instanceof types.Delimiter)\n          # find first non deleted op\n          o = o.next_cl\n        while true\n          # find the i-th op\n          if o instanceof types.Delimiter\n            break\n          if position <= 0 and not o.isDeleted()\n            break\n          o = o.next_cl\n          if not o.isDeleted()\n            position -= 1\n      o\n\n  #\n  # @nodoc\n  # Adds support for replace. The ReplaceManager manages Replaceable operations.\n  # Each Replaceable holds a value that is now replaceable.\n  #\n  # The WordType-type has implemented support for replace\n  # @see WordType\n  #\n  class ReplaceManager extends ListManager\n    #\n    # @param {Operation} initial_content Initialize this with a Replaceable that holds the initial_content.\n    # @param {Object} uid A unique identifier. If uid is undefined, a new uid will be created.\n    # @param {Delimiter} beginning Reference or Object.\n    # @param {Delimiter} end Reference or Object.\n    constructor: (initial_content, uid, beginning, end, prev, next, origin)->\n      super uid, beginning, end, prev, next, origin\n      if initial_content?\n        @replace initial_content\n\n    #\n    # Replace the existing word with a new word.\n    #\n    # @param content {Operation} The new value of this ReplaceManager.\n    # @param replaceable_uid {UID} Optional: Unique id of the Replaceable that is created\n    #\n    replace: (content, replaceable_uid)->\n      o = @getLastOperation()\n      op = new Replaceable content, @, replaceable_uid, o, o.next_cl\n      HB.addOperation(op).execute()\n\n    #\n    # Add change listeners for parent.\n    #\n    setParent: (parent, property_name)->\n      @on 'insert', (event, op)=>\n        if op.next_cl instanceof types.Delimiter\n          @parent.callEvent 'change', property_name\n      @on 'change', (event)=>\n        @parent.callEvent 'change', property_name\n      # Call this, when the first element is inserted. Then delete the listener.\n      addPropertyListener = (event, op)=>\n        if op.next_cl instanceof types.Delimiter and op.prev_cl instanceof types.Delimiter\n          @parent.callEvent 'addProperty', property_name\n        @deleteListener 'addProperty', addPropertyListener\n      @on 'insert', addPropertyListener\n      super parent\n      \n    #\n    # Get the value of this WordType\n    # @return {String}\n    #\n    val: ()->\n      o = @getLastOperation()\n      #if o instanceof types.Delimiter\n        # throw new Error \"Replace Manager doesn't contain anything.\"\n      o.val?() # ? - for the case that (currently) the RM does not contain anything (then o is a Delimiter)\n\n    #\n    # Encode this operation in such a way that it can be parsed by remote peers.\n    #\n    _encode: ()->\n      json =\n        {\n          'type': \"ReplaceManager\"\n          'uid' : @getUid()\n          'beginning' : @beginning.getUid()\n          'end' : @end.getUid()\n        }\n      if @prev_cl? and @next_cl?\n        json['prev'] = @prev_cl.getUid()\n        json['next'] = @next_cl.getUid()\n      if @origin? and @origin isnt @prev_cl\n        json[\"origin\"] = @origin.getUid()\n      json\n\n  parser[\"ReplaceManager\"] = (json)->\n    {\n      'content' : content\n      'uid' : uid\n      'prev': prev\n      'next': next\n      'origin' : origin\n      'beginning' : beginning\n      'end' : end\n    } = json\n    new ReplaceManager content, uid, beginning, end, prev, next, origin\n\n\n  #\n  # @nodoc\n  # The ReplaceManager manages Replaceables.\n  # @see ReplaceManager\n  #\n  class Replaceable extends types.Insert\n\n    #\n    # @param {Operation} content The value that this Replaceable holds.\n    # @param {ReplaceManager} parent Used to replace this Replaceable with another one.\n    # @param {Object} uid A unique identifier. If uid is undefined, a new uid will be created.\n    #\n    constructor: (content, parent, uid, prev, next, origin)->\n      @saveOperation 'content', content\n      @saveOperation 'parent', parent\n      if not (prev? and next? and content?)\n        throw new Error \"You must define content, prev, and next for Replaceable-types!\"\n      super uid, prev, next, origin\n\n    #\n    # Return the content that this operation holds.\n    #\n    val: ()->\n      @content\n\n    #\n    # Replace the content of this replaceable with new content.\n    #\n    replace: (content)->\n      @parent.replace content\n\n    #\n    # If possible set the replace manager in the content.\n    # @see WordType.setReplaceManager\n    #\n    execute: ()->\n      if not @validateSavedOperations()\n        return false\n      else\n        @content.setReplaceManager?(@parent)\n        super\n\n    #\n    # Encode this operation in such a way that it can be parsed by remote peers.\n    #\n    _encode: ()->\n      json =\n        {\n          'type': \"Replaceable\"\n          'content': @content.getUid()\n          'ReplaceManager' : @parent.getUid()\n          'prev': @prev_cl.getUid()\n          'next': @next_cl.getUid()\n          'uid' : @getUid()\n        }\n      if @origin? and @origin isnt @prev_cl\n        json[\"origin\"] = @origin.getUid()\n      json\n\n  parser[\"Replaceable\"] = (json)->\n    {\n      'content' : content\n      'ReplaceManager' : parent\n      'uid' : uid\n      'prev': prev\n      'next': next\n      'origin' : origin\n    } = json\n    new Replaceable content, parent, uid, prev, next, origin\n\n\n\n  types['ListManager'] = ListManager\n  types['MapManager'] = MapManager\n  types['ReplaceManager'] = ReplaceManager\n  types['Replaceable'] = Replaceable\n\n  basic_types\n\n\n\n\n\n\n"]}