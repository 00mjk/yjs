!function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return r(n?n:e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t){var n=[].slice,i={}.hasOwnProperty,r=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};t.exports=function(e){var t,i,o,s,a,l,u;return u={},l=[],a=function(){function t(t){null==t&&(t=e.getNextOperationIdentifier()),this.creator=t.creator,this.op_number=t.op_number}return t.prototype.on=function(e,t){var n,i,r,o,s;for(null==this.event_listeners&&(this.event_listeners={}),e.constructor!==[].constructor&&(e=[e]),s=[],r=0,o=e.length;o>r;r++)n=e[r],null==(i=this.event_listeners)[n]&&(i[n]=[]),s.push(this.event_listeners[n].push(t));return s},t.prototype.deleteListener=function(e,t){var n,i,r,o,s;for(e.constructor!==[].constructor&&(e=[e]),s=[],i=0,r=e.length;r>i;i++)n=e[i],s.push(null!=(null!=(o=this.event_listeners)?o[n]:void 0)?this.event_listeners[n]=this.event_listeners[n].filter(function(e){return t!==e}):void 0);return s},t.prototype.callEvent=function(){return this.forwardEvent.apply(this,[this].concat(n.call(arguments)))},t.prototype.forwardEvent=function(){var e,t,i,r,o,s,a,l,u;if(r=arguments[0],t=arguments[1],e=3<=arguments.length?n.call(arguments,2):[],null!=(null!=(a=this.event_listeners)?a[t]:void 0)){for(l=this.event_listeners[t],u=[],o=0,s=l.length;s>o;o++)i=l[o],u.push(i.call.apply(i,[r,t].concat(n.call(e))));return u}},t.prototype.setParent=function(e){this.parent=e},t.prototype.getParent=function(){return this.parent},t.prototype.getUid=function(){return{creator:this.creator,op_number:this.op_number}},t.prototype.execute=function(){var e,t,n;for(this.is_executed=!0,t=0,n=l.length;n>t;t++)(e=l[t])(this._encode());return this},t.prototype.saveOperation=function(e,t){return null!=(null!=t?t.execute:void 0)?this[e]=t:null!=t?(null==this.unchecked&&(this.unchecked={}),this.unchecked[e]=t):void 0},t.prototype.validateSavedOperations=function(){var t,n,i,r,o,s;o={},r=this,s=this.unchecked;for(t in s)i=s[t],n=e.getOperation(i),n?this[t]=n:(o[t]=i,r=!1);return delete this.unchecked,r||(this.unchecked=o),r},t}(),t=function(e){function t(e,n){this.saveOperation("deletes",n),t.__super__.constructor.call(this,e)}return r(t,e),t.prototype._encode=function(){return{type:"Delete",uid:this.getUid(),deletes:this.deletes.getUid()}},t.prototype.execute=function(){return this.validateSavedOperations()?(this.deletes.applyDelete(this),t.__super__.execute.apply(this,arguments)):!1},t}(a),u.Delete=function(e){var n,i;return i=e.uid,n=e.deletes,new t(i,n)},s=function(e){function t(e,n,i,r){this.saveOperation("prev_cl",n),this.saveOperation("next_cl",i),null!=r?this.saveOperation("origin",r):this.saveOperation("origin",n),t.__super__.constructor.call(this,e)}return r(t,e),t.prototype.applyDelete=function(e){return null==this.deleted_by&&(this.deleted_by=[]),this.deleted_by.push(e),null!=this.parent&&1===this.deleted_by.length?this.parent.callEvent("delete",this):void 0},t.prototype.isDeleted=function(){var e;return(null!=(e=this.deleted_by)?e.length:void 0)>0},t.prototype.getDistanceToOrigin=function(){var e,t;for(e=0,t=this.prev_cl;;){if(this.origin===t)break;if(e++,this===this.prev_cl)throw new Error("this should not happen ;) ");t=t.prev_cl}return e},t.prototype.update_sl=function(){var e;return e=this.prev_cl,update("prev_cl","prev_sl"),update("next_cl","prev_sl")},t.prototype.execute=function(){var e,n,i,r,o,s,a;if(null!=this.is_executed)return this;if(this.validateSavedOperations()){if((null!=(o=this.prev_cl)?o.validateSavedOperations():void 0)&&(null!=(s=this.next_cl)?s.validateSavedOperations():void 0)&&this.prev_cl.next_cl!==this){for(e=0,i=this.prev_cl.next_cl,n=0;;){if(null==i&&(console.log(JSON.stringify(this.prev_cl.getUid())),console.log(JSON.stringify(this.next_cl.getUid()))),i===this.next_cl)break;if(i.getDistanceToOrigin()===n)i.creator<this.creator&&(this.prev_cl=i,e=n+1);else{if(!(i.getDistanceToOrigin()<n))break;n-e<=i.getDistanceToOrigin()&&(this.prev_cl=i,e=n+1)}n++,i=i.next_cl}this.next_cl=this.prev_cl.next_cl,this.prev_cl.next_cl=this,this.next_cl.prev_cl=this}return r=null!=(a=this.prev_cl)?a.getParent():void 0,null!=r&&(this.setParent(r),this.parent.callEvent("insert",this)),t.__super__.execute.apply(this,arguments)}return!1},t.prototype.getPosition=function(){var e,t;for(e=0,t=this.prev_cl;;){if(t instanceof i)break;null==t.isDeleted||t.isDeleted()||e++,t=t.prev_cl}return e},t}(a),o=function(e){function t(e,n,i,r,o){this.content=n,t.__super__.constructor.call(this,e,i,r,o)}return r(t,e),t.prototype.val=function(){return this.content},t.prototype._encode=function(){var e;return e={type:"ImmutableObject",uid:this.getUid(),content:this.content},null!=this.prev_cl&&(e.prev=this.prev_cl.getUid()),null!=this.next_cl&&(e.next=this.next_cl.getUid()),null!=this.origin&&this.origin!==this.prev_cl&&(e.origin=this.origin.getUid()),e},t}(s),u.ImmutableObject=function(e){var t,n,i,r,s;return s=e.uid,t=e.content,r=e.prev,n=e.next,i=e.origin,new o(s,t,r,n,i)},i=function(e){function t(e,n,i){this.saveOperation("prev_cl",n),this.saveOperation("next_cl",i),this.saveOperation("origin",n),t.__super__.constructor.call(this,e)}return r(t,e),t.prototype.isDeleted=function(){return!1},t.prototype.execute=function(){var e,n;if(null!=(null!=(e=this.unchecked)?e.next_cl:void 0))return t.__super__.execute.apply(this,arguments);if(null!=(n=this.unchecked)?n.prev_cl:void 0){if(this.validateSavedOperations()){if(null!=this.prev_cl.next_cl)throw new Error("Probably duplicated operations");return this.prev_cl.next_cl=this,delete this.prev_cl.unchecked.next_cl,t.__super__.execute.apply(this,arguments)}return!1}if(null!=this.prev_cl&&null==this.prev_cl.next_cl)return delete this.prev_cl.unchecked.next_cl,this.prev_cl.next_cl=this;if(null!=this.prev_cl||null!=this.next_cl)return t.__super__.execute.apply(this,arguments);throw new Error("Delimiter is unsufficient defined!")},t.prototype._encode=function(){var e,t;return{type:"Delimiter",uid:this.getUid(),prev:null!=(e=this.prev_cl)?e.getUid():void 0,next:null!=(t=this.next_cl)?t.getUid():void 0}},t}(a),u.Delimiter=function(e){var t,n,r;return r=e.uid,n=e.prev,t=e.next,new i(r,n,t)},{types:{Delete:t,Insert:s,Delimiter:i,Operation:a,ImmutableObject:o},parser:u,execution_listener:l}}},{}],2:[function(e,t){var n,i={}.hasOwnProperty,r=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("./BasicTypes"),t.exports=function(e){var t,i,o,s,a,l,u,c;return l=n(e),c=l.types,u=l.parser,o=function(n){function i(e){this.map={},i.__super__.constructor.call(this,e)}return r(i,n),i.prototype.val=function(n,r){var o,s,a,l,u;if(null!=r)return null==this.map[n]&&e.addOperation(new t(void 0,this,n)).execute(),this.map[n].replace(r),this;if(null!=n)return s=null!=(l=this.map[n])?l.val():void 0,s instanceof c.ImmutableObject?s.val():s;a={},u=this.map;for(n in u)o=u[n],s=o.val(),(s instanceof c.ImmutableObject||s instanceof i)&&(s=s.val()),a[n]=s;return a},i}(c.Operation),t=function(t){function n(e,t,i){this.name=i,this.saveOperation("map_manager",t),n.__super__.constructor.call(this,e)}return r(n,t),n.prototype.execute=function(){var t,i,r,o,a;return this.validateSavedOperations()?(a=this.map_manager.getUid(),a.op_number="_"+a.op_number+"_RM_"+this.name,null==e.getOperation(a)&&(r=this.map_manager.getUid(),r.op_number="_"+r.op_number+"_RM_"+this.name+"_beginning",o=this.map_manager.getUid(),o.op_number="_"+o.op_number+"_RM_"+this.name+"_end",t=e.addOperation(new c.Delimiter(r,void 0,o)).execute(),i=e.addOperation(new c.Delimiter(o,t,void 0)).execute(),this.map_manager.map[this.name]=e.addOperation(new s(void 0,a,t,i)),this.map_manager.map[this.name].setParent(this.map_manager,this.name),this.map_manager.map[this.name].execute()),n.__super__.execute.apply(this,arguments)):!1},n.prototype._encode=function(){return{type:"AddName",uid:this.getUid(),map_manager:this.map_manager.getUid(),name:this.name}},n}(c.Operation),u.AddName=function(e){var n,i,r;return n=e.map_manager,r=e.uid,i=e.name,new t(r,n,i)},i=function(t){function n(t,i,r,o,s,a){null!=i&&null!=r?(this.saveOperation("beginning",i),this.saveOperation("end",r)):(this.beginning=e.addOperation(new c.Delimiter(void 0,void 0,void 0)),this.end=e.addOperation(new c.Delimiter(void 0,this.beginning,void 0)),this.beginning.next_cl=this.end,this.beginning.execute(),this.end.execute()),n.__super__.constructor.call(this,t,o,s,a)}return r(n,t),n.prototype.execute=function(){return this.validateSavedOperations()?(this.beginning.setParent(this),this.end.setParent(this),n.__super__.execute.apply(this,arguments)):!1},n.prototype.getLastOperation=function(){return this.end.prev_cl},n.prototype.getFirstOperation=function(){return this.beginning.next_cl},n.prototype.toArray=function(){var e,t;for(e=this.beginning.next_cl,t=[];e!==this.end;)t.push(e),e=e.next_cl;return t},n.prototype.getOperationByPosition=function(e){var t;if(t=this.beginning.next_cl,(e>0||t.isDeleted())&&!(t instanceof c.Delimiter)){for(;t.isDeleted()&&!(t instanceof c.Delimiter);)t=t.next_cl;for(;;){if(t instanceof c.Delimiter)break;if(0>=e&&!t.isDeleted())break;t=t.next_cl,t.isDeleted()||(e-=1)}}return t},n}(c.Insert),s=function(t){function n(e,t,i,r,o,s,a){n.__super__.constructor.call(this,t,i,r,o,s,a),null!=e&&this.replace(e)}return r(n,t),n.prototype.replace=function(t,n){var i,r;return i=this.getLastOperation(),r=new a(t,this,n,i,i.next_cl),e.addOperation(r).execute()},n.prototype.setParent=function(e,t){var i;return this.on("insert",function(e){return function(n,i){return i.next_cl instanceof c.Delimiter?e.parent.callEvent("change",t):void 0}}(this)),this.on("change",function(e){return function(){return e.parent.callEvent("change",t)}}(this)),i=function(e){return function(n,r){return r.next_cl instanceof c.Delimiter&&r.prev_cl instanceof c.Delimiter&&e.parent.callEvent("addProperty",t),e.deleteListener("addProperty",i)}}(this),this.on("insert",i),n.__super__.setParent.call(this,e)},n.prototype.val=function(){var e;return e=this.getLastOperation(),"function"==typeof e.val?e.val():void 0},n.prototype._encode=function(){var e;return e={type:"ReplaceManager",uid:this.getUid(),beginning:this.beginning.getUid(),end:this.end.getUid()},null!=this.prev_cl&&null!=this.next_cl&&(e.prev=this.prev_cl.getUid(),e.next=this.next_cl.getUid()),null!=this.origin&&this.origin!==this.prev_cl&&(e.origin=this.origin.getUid()),e},n}(i),u.ReplaceManager=function(e){var t,n,i,r,o,a,l;return n=e.content,l=e.uid,a=e.prev,r=e.next,o=e.origin,t=e.beginning,i=e.end,new s(n,l,t,i,a,r,o)},a=function(e){function t(e,n,i,r,o,s){if(this.saveOperation("content",e),this.saveOperation("parent",n),null==r||null==o||null==e)throw new Error("You must define content, prev, and next for Replaceable-types!");t.__super__.constructor.call(this,i,r,o,s)}return r(t,e),t.prototype.val=function(){return this.content},t.prototype.replace=function(e){return this.parent.replace(e)},t.prototype.execute=function(){var e;return this.validateSavedOperations()?("function"==typeof(e=this.content).setReplaceManager&&e.setReplaceManager(this.parent),t.__super__.execute.apply(this,arguments)):!1},t.prototype._encode=function(){var e;return e={type:"Replaceable",content:this.content.getUid(),ReplaceManager:this.parent.getUid(),prev:this.prev_cl.getUid(),next:this.next_cl.getUid(),uid:this.getUid()},null!=this.origin&&this.origin!==this.prev_cl&&(e.origin=this.origin.getUid()),e},t}(c.Insert),u.Replaceable=function(e){var t,n,i,r,o,s;return t=e.content,r=e.ReplaceManager,s=e.uid,o=e.prev,n=e.next,i=e.origin,new a(t,r,s,o,n,i)},c.ListManager=i,c.MapManager=o,c.ReplaceManager=s,c.Replaceable=a,l}},{"./BasicTypes":1}]},{},[2]);