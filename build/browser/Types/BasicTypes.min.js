!function t(e,n,r){function i(l,o){if(!n[l]){if(!e[l]){var u="function"==typeof require&&require;if(!o&&u)return u(l,!0);if(s)return s(l,!0);throw new Error("Cannot find module '"+l+"'")}var c=n[l]={exports:{}};e[l][0].call(c.exports,function(t){var n=e[l][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[l].exports}for(var s="function"==typeof require&&require,l=0;l<r.length;l++)i(r[l]);return i}({1:[function(t,e){var n=[].slice,r={}.hasOwnProperty,i=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};e.exports=function(t){var e,r,s,l,o,u,c;return c={},u=[],o=function(){function e(e){null==e&&(e=t.getNextOperationIdentifier()),this.creator=e.creator,this.op_number=e.op_number}return e.prototype.on=function(t,e){var n,r,i,s,l;for(null==this.event_listeners&&(this.event_listeners={}),t.constructor!==[].constructor&&(t=[t]),l=[],i=0,s=t.length;s>i;i++)n=t[i],null==(r=this.event_listeners)[n]&&(r[n]=[]),l.push(this.event_listeners[n].push(e));return l},e.prototype.deleteListener=function(t,e){var n,r,i,s,l;for(t.constructor!==[].constructor&&(t=[t]),l=[],r=0,i=t.length;i>r;r++)n=t[r],l.push(null!=(null!=(s=this.event_listeners)?s[n]:void 0)?this.event_listeners[n]=this.event_listeners[n].filter(function(t){return e!==t}):void 0);return l},e.prototype.callEvent=function(){return this.forwardEvent.apply(this,[this].concat(n.call(arguments)))},e.prototype.forwardEvent=function(){var t,e,r,i,s,l,o,u,c;if(i=arguments[0],e=arguments[1],t=3<=arguments.length?n.call(arguments,2):[],null!=(null!=(o=this.event_listeners)?o[e]:void 0)){for(u=this.event_listeners[e],c=[],s=0,l=u.length;l>s;s++)r=u[s],c.push(r.call.apply(r,[i,e].concat(n.call(t))));return c}},e.prototype.setParent=function(t){this.parent=t},e.prototype.getParent=function(){return this.parent},e.prototype.getUid=function(){return{creator:this.creator,op_number:this.op_number}},e.prototype.execute=function(){var t,e,n;for(this.is_executed=!0,e=0,n=u.length;n>e;e++)(t=u[e])(this._encode());return this},e.prototype.saveOperation=function(t,e){return null!=(null!=e?e.execute:void 0)?this[t]=e:null!=e?(null==this.unchecked&&(this.unchecked={}),this.unchecked[t]=e):void 0},e.prototype.validateSavedOperations=function(){var e,n,r,i,s,l;s={},i=this,l=this.unchecked;for(e in l)r=l[e],n=t.getOperation(r),n?this[e]=n:(s[e]=r,i=!1);return delete this.unchecked,i||(this.unchecked=s),i},e}(),e=function(t){function e(t,n){this.saveOperation("deletes",n),e.__super__.constructor.call(this,t)}return i(e,t),e.prototype._encode=function(){return{type:"Delete",uid:this.getUid(),deletes:this.deletes.getUid()}},e.prototype.execute=function(){return this.validateSavedOperations()?(this.deletes.applyDelete(this),e.__super__.execute.apply(this,arguments)):!1},e}(o),c.Delete=function(t){var n,r;return r=t.uid,n=t.deletes,new e(r,n)},l=function(t){function e(t,n,r,i){this.saveOperation("prev_cl",n),this.saveOperation("next_cl",r),null!=i?this.saveOperation("origin",i):this.saveOperation("origin",n),e.__super__.constructor.call(this,t)}return i(e,t),e.prototype.applyDelete=function(t){return null==this.deleted_by&&(this.deleted_by=[]),this.deleted_by.push(t),null!=this.parent&&1===this.deleted_by.length?this.parent.callEvent("delete",this):void 0},e.prototype.isDeleted=function(){var t;return(null!=(t=this.deleted_by)?t.length:void 0)>0},e.prototype.getDistanceToOrigin=function(){var t,e;for(t=0,e=this.prev_cl;;){if(this.origin===e)break;if(t++,this===this.prev_cl)throw new Error("this should not happen ;) ");e=e.prev_cl}return t},e.prototype.update_sl=function(){var t;return t=this.prev_cl,update("prev_cl","prev_sl"),update("next_cl","prev_sl")},e.prototype.execute=function(){var t,n,r,i,s,l,o;if(null!=this.is_executed)return this;if(this.validateSavedOperations()){if((null!=(s=this.prev_cl)?s.validateSavedOperations():void 0)&&(null!=(l=this.next_cl)?l.validateSavedOperations():void 0)&&this.prev_cl.next_cl!==this){for(t=0,r=this.prev_cl.next_cl,n=0;;){if(null==r&&(console.log(JSON.stringify(this.prev_cl.getUid())),console.log(JSON.stringify(this.next_cl.getUid()))),r===this.next_cl)break;if(r.getDistanceToOrigin()===n)r.creator<this.creator&&(this.prev_cl=r,t=n+1);else{if(!(r.getDistanceToOrigin()<n))break;n-t<=r.getDistanceToOrigin()&&(this.prev_cl=r,t=n+1)}n++,r=r.next_cl}this.next_cl=this.prev_cl.next_cl,this.prev_cl.next_cl=this,this.next_cl.prev_cl=this}return i=null!=(o=this.prev_cl)?o.getParent():void 0,null!=i&&(this.setParent(i),this.parent.callEvent("insert",this)),e.__super__.execute.apply(this,arguments)}return!1},e.prototype.getPosition=function(){var t,e;for(t=0,e=this.prev_cl;;){if(e instanceof r)break;null==e.isDeleted||e.isDeleted()||t++,e=e.prev_cl}return t},e}(o),s=function(t){function e(t,n,r,i,s){this.content=n,e.__super__.constructor.call(this,t,r,i,s)}return i(e,t),e.prototype.val=function(){return this.content},e.prototype._encode=function(){var t;return t={type:"ImmutableObject",uid:this.getUid(),content:this.content},null!=this.prev_cl&&(t.prev=this.prev_cl.getUid()),null!=this.next_cl&&(t.next=this.next_cl.getUid()),null!=this.origin&&this.origin!==this.prev_cl&&(t.origin=this.origin.getUid()),t},e}(l),c.ImmutableObject=function(t){var e,n,r,i,l;return l=t.uid,e=t.content,i=t.prev,n=t.next,r=t.origin,new s(l,e,i,n,r)},r=function(t){function e(t,n,r){this.saveOperation("prev_cl",n),this.saveOperation("next_cl",r),this.saveOperation("origin",n),e.__super__.constructor.call(this,t)}return i(e,t),e.prototype.isDeleted=function(){return!1},e.prototype.execute=function(){var t,n;if(null!=(null!=(t=this.unchecked)?t.next_cl:void 0))return e.__super__.execute.apply(this,arguments);if(null!=(n=this.unchecked)?n.prev_cl:void 0){if(this.validateSavedOperations()){if(null!=this.prev_cl.next_cl)throw new Error("Probably duplicated operations");return this.prev_cl.next_cl=this,delete this.prev_cl.unchecked.next_cl,e.__super__.execute.apply(this,arguments)}return!1}if(null!=this.prev_cl&&null==this.prev_cl.next_cl)return delete this.prev_cl.unchecked.next_cl,this.prev_cl.next_cl=this;if(null!=this.prev_cl||null!=this.next_cl)return e.__super__.execute.apply(this,arguments);throw new Error("Delimiter is unsufficient defined!")},e.prototype._encode=function(){var t,e;return{type:"Delimiter",uid:this.getUid(),prev:null!=(t=this.prev_cl)?t.getUid():void 0,next:null!=(e=this.next_cl)?e.getUid():void 0}},e}(o),c.Delimiter=function(t){var e,n,i;return i=t.uid,n=t.prev,e=t.next,new r(i,n,e)},{types:{Delete:e,Insert:l,Delimiter:r,Operation:o,ImmutableObject:s},parser:c,execution_listener:u}}},{}]},{},[1]);